<app-divergence-modal [receivementId]="sendId"></app-divergence-modal>

<div class="container">
  <h3 ngbAutofocus>Recebimento por Transferência</h3>
  <form [formGroup]="form" class="needs-validation" (ngSubmit)="onSubmit()">

    <div class="form-group d-flex flex-lg-wrap">
      <div class="form-group col-2">
        <label for="stm">STM</label>
        <input type="text" class="form-control input-disabled" placeholder="Código STM" maxlength="100"
          formControlName="stm">
      </div>
      <div class="form-group col-2">
        <label for="transfer">Transferência</label>
        <input type="text" class="form-control input-disabled" placeholder="Transferência" maxlength="100"
          formControlName="transfer">
      </div>
      <div class="form-group col-2">
        <label for="emissionDate">Data Emissão</label>
        <input type="text" class="form-control input-disabled" placeholder="Data Emissão" maxlength="10"
          formControlName="emissionDate">
      </div>
      <div class="form-group col-2">
        <label for="transferStatus">Status Transferência</label>
        <input type="text" class="form-control input-disabled" placeholder="Status Transferência" maxlength="100"
          formControlName="transferStatus">
      </div>
      <div class="form-group col-2">
        <label for="requester">Requisitante</label>
        <input type="text" class="form-control input-disabled" placeholder="Requisitante" maxlength="100"
          formControlName="requester">
      </div>
      <div class="form-group col-2">
        <label for="approver">Aprovador</label>
        <input type="text" class="form-control input-disabled" placeholder="Aprovador" maxlength="100"
          formControlName="approver">
      </div>
    </div>

    <div class="form-group d-flex flex-lg-wrap">
      <div class="form-group col-3">
        <label for="sourceInstallation">Instalação Origem</label>
        <input type="text" class="form-control input-disabled" placeholder="Instalação Origem" maxlength="100"
          formControlName="sourceInstallation">
      </div>
      <div class="form-group col-3">
        <label for="sourceCnpj">CNPJ Origem</label>
        <input type="text" class="form-control input-disabled" placeholder="CNPJ Origem" maxlength="18"
          formControlName="sourceCnpj">
      </div>
      <div class="form-group col-3">
        <label for="targetInstallation">Instalação Destino</label>
        <input type="text" class="form-control input-disabled" placeholder="Instalação Destino" maxlength="100"
          formControlName="targetInstallation">
      </div>
      <div class="form-group col-3">
        <label for="targetCnpj">CNPJ Destino</label>
        <input type="text" class="form-control input-disabled" placeholder="CNPJ Destino" maxlength="18"
          formControlName="targetCnpj">
      </div>
    </div>

    <div class="row row-visualization">
      <span class="fas fa-external-link-alt icon-visualization"></span>
      <span class="link-photos">Visualizar Fotos do Embarque</span>
    </div>

    <table class="table table-details">
      <thead>
        <tr>
          <th>Item</th>
          <th>Cod. Material</th>
          <th>Descrição</th>
          <th>Un.</th>
          <th>Qtd. Solicitada</th>
          <th>Qtd. Transferida</th>
          <th>Pendente STM</th>
          <th>Qtd. Tranferência</th>
          <th>Pendente</th>
          <th>Qtd. Recebimento</th>
          <th>Novo Saldo</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Item</td>
          <td>Cod. Material</td>
          <td>Descrição</td>
          <td>Un.</td>
          <td>Qtd. Solicitada</td>
          <td>Qtd. Transferida</td>
          <td>Pendente STM</td>
          <td>Qtd. Tranferência</td>
          <td>Pendente</td>
          <td>Qtd. Recebimento</td>
          <td>Novo Saldo</td>
        </tr>
        <tr>
          <td>Item</td>
          <td>Cod. Material</td>
          <td>Descrição</td>
          <td>Un.</td>
          <td>Qtd. Solicitada</td>
          <td>Qtd. Transferida</td>
          <td>Pendente STM</td>
          <td>Qtd. Tranferência</td>
          <td>Pendente</td>
          <td>Qtd. Recebimento</td>
          <td>Novo Saldo</td>
        </tr>
      </tbody>
    </table>


    <div class="form-group d-flex flex-lg-wrap">
      <div class="form-group col-4">
        <label for="invoiceEntrance">NF de Entrada</label>
        <input type="text" class="form-control input-disabled" placeholder="NF de Entrada" maxlength="100"
          formControlName="invoiceEntrance">
      </div>
      <div class="form-group col-4">
        <label for="invoiceNumber">Número NF</label>
        <input type="text" class="form-control input-disabled" placeholder="Número NF" maxlength="100"
          formControlName="invoiceNumber">
      </div>
      <div class="form-group col-4">
        <label for="invoiceDate">Data NF</label>
        <input type="text" class="form-control input-disabled" placeholder="Data NF" maxlength="10"
          formControlName="invoiceDate">
      </div>
    </div>

    <div class="form-group d-flex flex-lg-wrap">
      <div class="form-group col-6">
        <label for="receiverUser">Recebido por</label>
        <ng-select bindLabel="text" bindValue="id" (change)="fillUserCombo()" formControlName="receiverUser"
          placeholder="Selecione">
          <ng-option *ngFor="let responsible of responsibles" [value]="responsible.id">{{ responsible.text }}
          </ng-option>
        </ng-select>
      </div>
      <div class="form-group col-6">
        <app-datepicker labelName="Data Recebimento" (dateChange)="setReceivementDate($event)"
          formControlName="receivementDate"></app-datepicker>
      </div>
    </div>

    <div class="form-group d-flex flex-lg-wrap">
      <div class="form-group col-4">
        <label for="vehiclePlate">Placa do Veículo</label>
        <input type="text" class="form-control" placeholder="ADG-1234" maxlength="8" mask="SSS-0A00"
          formControlName="vehiclePlate">
      </div>
      <div class="form-group col-4">
        <label for="driverName">Nome do Motorista</label>
        <input type="text" class="form-control" placeholder="Nome do Motorista" maxlength="100"
          formControlName="driverName">
      </div>
      <div class="form-group col-4">
        <label for="driverTelephone">Telefone do Motorista</label>
        <input type="text" name="driverTelephone" id="driverTelephone" class="form-control"
          formControlName="driverTelephone" mask="{{ maskTel }}" (change)="maskTelephone($event.target.value)">
      </div>
    </div>

    <div class="form-group col-12">
      <label for="emails">Incluir E-mails</label>
      <ng-select [addTag]="true" [multiple]="true" placeholder="Selecione" formControlName="emails">
      </ng-select>
    </div>

    <div class="form-group col-12">
      <label for="notes">Observações</label>
      <textarea rows="4" cols="50" class="form-control" placeholder="Observações" maxlength="300"
        formControlName="notes"></textarea>
    </div>

    <div class="form-group col">
      <div class="row">
        <div class="col">
          <app-attach-file title="Fotos do Recebimento" [multiple]="true" (change)="photosHandler($event.target.files)">
          </app-attach-file>
        </div>
        <div class="col">
          <app-attach-file title="Nota Fiscal" [multiple]="true" (change)="invoiceDocHandler($event.target.files)">
          </app-attach-file>
        </div>
        <div class="col">
          <app-attach-file title="Anexos Adicionais" [multiple]="true"
            (change)="attachmentsHandler($event.target.files)">
          </app-attach-file>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-outline-success btn-filter mr-auto" (click)="saveAsDraft()">
        <span class="fas fa-pen"></span> Salvar como Rascunho
      </button>
      <button type="button" class="btn btn-outline-success btn-divergence" (click)="openDivergencesModal();">
        <span class="fa fa-exclamation"></span> Divergência
      </button>
      <button type="button" class="btn btn-outline-success btn-save" (click)="reviewOrder();">
        <span class="fas fa-eye"></span> Revisar
      </button>
    </div>
  </form>
</div>




























<ng-template #finalDetailsModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title blue-title" ngbAutofocus>STM {{ this.stmResult | emptyField }}</h4>
    <h4 class="modal-title blue-title-second">Transferência {{ this.transferResult | emptyField }}</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss();">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="card single-card">
    <div class="card-body single-card__body">
      <div class="row">
        <div class="col">
          <p class="information-title">Data Emissão</p>
          <span class="information-item">{{ this.emissionDateResult | date: 'dd/MM/yyyy' }}</span>
        </div>
        <div class="col">
          <p class="information-title">Status Transferência</p>
          <app-status [status]="data.status"></app-status>
        </div>
        <div class="col">
          <p class="information-title">Requisitante</p>
          <span class="information-item">{{ this.requesterResult | emptyField }}</span>
        </div>
        <div class="col">
          <p class="information-title">Aprovador</p>
          <span class="information-item">{{ this.approverResult | emptyField }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="row">

    <div class="col-4">
      <div class="card triple-card-first-position">
        <div class="card-body triple-card__body">
          <div class="row">
            <div class="col">
              <p class="information-title">Instalação Origem</p>
              <span class="information-item">{{ data.installationSource }}</span>
            </div>
            <div class="col">
              <p class="information-title">CNPJ Origem</p>
              <span class="information-item">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-4">
      <div class="card triple-card-second-position">
        <div class="card-body triple-card__body">
          <div class="row">
            <div class="col">
              <p class="information-title">Instalação Destino</p>
              <span class="information-item">{{ data.installationDestiny }}</span>
            </div>
            <div class="col">
              <p class="information-title">CNPJ Destino</p>
              <span class="information-item">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-4">
      <div class="card triple-card-third-position">
        <div class="card-body triple-card__body">
          <div class="row">
            <div class="col">
              <span class="information-title">NF Entrada</span>
              <p class="information-item">-</p>
            </div>
            <div class="col">
              <span class="information-title">Número NF</span>
              <p class="information-item">-</p>
            </div>
            <div class="col">
              <span class="information-title">Data da NF</span>
              <p class="information-item">-</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>





  <table class="table table-striped modal-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>Cod. Material</th>
        <th>Cod. Prod. Form.</th>
        <th>Descrição</th>
        <th>Un.</th>
        <th>Qtd. Prod</th>
        <th>Valor Un.</th>
        <th>Valor Total</th>
        <th>Recebido</th>
        <th>Pendente</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
      </tr>
      <tr>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
      </tr>
    </tbody>
  </table>

  <div class="row">
    <div class="col-4">
      <app-review-archive-list componentTitle='Fotos de Recebimento' componentClass="card triple-card-first-position"
        [archiveList]="receivementPhotos"></app-review-archive-list>
    </div>
    <div class="col-4">
      <app-review-archive-list componentTitle='Nota Fiscal' componentClass="card triple-card-second-position"
        [archiveList]="invoiceDoc"></app-review-archive-list>
    </div>
    <div class="col-4">
      <app-review-archive-list componentTitle='Anexos Adicionais' componentClass="card triple-card-third-position"
        [archiveList]="additionalAttachments"></app-review-archive-list>
    </div>
  </div>

  <div class="card single-card">
    <div class="card-body single-card__body">
      <div class="row">
        <div class="col-1">
          <img src="../../../../assets/images/icone_expedicao.svg" alt="Recebimento">
        </div>
        <div class="col">
          <span class="information-title">Resp. Expedição</span>
          <p class="information-item">-</p>
        </div>
        <div class="col">
          <span class="information-title">Data Expedição</span>
          <p class="information-item">-</p>
        </div>
        <div class="col">
          <span class="information-title">Previsão Entrega</span>
          <p class="information-item">-</p>
        </div>
        <div class="col">
          <span class="information-title">Nome do Motorista</span>
          <p class="information-item">-</p>
        </div>
        <div class="col">
          <span class="information-title">Placa do Veículo</span>
          <p class="information-item">-</p>
        </div>
        <div class="col">
          <span class="information-title">Telefone do Motorista</span>
          <p class="information-item">-</p>
        </div>
      </div>
    </div>
  </div>

  <div class="card single-card single-card--bottom-line">
    <div class="card-body single-card__body">
      <div class="row">
        <div class="col-1">
          <img src="../../../../assets/images/icone_recebimento.svg" alt="Recebimento">
        </div>
        <div class="col-3">
          <span class="information-title">Responsável pelo Recebimento</span>
          <p class="information-item">{{ this.receiverUserResult | abbreviateName }}</p>
        </div>
        <div class="col-2">
          <span class="information-title">Data do Recebimento</span>
          <p class="information-item">{{ this.receivementDateResult | date: 'dd/MM/yyyy' }}</p>
        </div>
        <div class="col-2">
          <span class="information-title">Nome do Motorista</span>
          <p class="information-item">{{ this.receivementDriverNameResult | abbreviateName }}</p>
        </div>
        <div class="col-2">
          <span class="information-title">Placa do Veículo</span>
          <p class="information-item">{{ this.receivementVehiclePlateResult | vehiclePlate }}</p>
        </div>
        <div class="col-2">
          <span class="information-title">Telefone do Motorista</span>
          <p class="information-item">{{ this.receivementDriverTelephoneResult | telephoneNumber }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="card single-card single-card--email">
    <div class="card-body single-card__body">
      <div class="row">
        <div class="col">
          <span class="information-title">E-mails</span>
          <p class="information-item">{{ this.emailsResult | emptyField }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="card single-card single-card--comments">
    <div class="card-body single-card__body">
      <div class="row">
        <div class="col">
          <span class="information-title">Observações</span>
          <p class="information-item">{{ this.commentsResult | emptyField }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-outline-success btn-export"
      (click)="genericPage.getData(); modal.dismiss(); cancelAction();">
      <span class="fa fa-share-square"></span>
      Exportar
    </button>
    <button type="button" class="btn btn-outline-success btn-print mr-auto"
      (click)="genericPage.getData(); modal.dismiss();">
      <span class="fa fa-print"></span>
      Imprimir
    </button>
    <button type="button" class="btn btn-outline-success btn-cancel" (click)="modal.dismiss();">
      <span class="fa fa-times"></span>
      Fechar
    </button>
    <button type="button" class="btn btn-outline-success btn-filter" (click)="saveAsDraft()">
      <span class="fas fa-pen"></span> Salvar como Rascunho
    </button>
    <button type="button" class="btn btn-outline-success btn-save" (click)="SaveReceivement(); modal.dismiss();">
      <span class="fas fa-check"></span>
      Finalizar
    </button>
  </div>
</ng-template>
